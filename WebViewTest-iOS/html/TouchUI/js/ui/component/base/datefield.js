/*!
 * datefield component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,n){"use strict";function a(){return s?s:(e(n.body).append('<div id="'+p+'_float" class="c_float'+(c?" c_float-phone-auto":"")+'" style="width:22em;"><div  id="'+p+'_float_bg" class="bg"></div><div  id="'+p+'_float_content" class="content"></div></div>'),s=e.Calendar.append(p+"_float_content",{name:p,className:"c_calendar"+(c?"":" c_calendar-s")}),e("#"+p).select(function(n){d&&t[d]&&t[d]instanceof u&&!0!==t[d].useTime&&!0===t[d].dropDown&&(t[d].val(this.val()),e.event.trigger("afterAction",null,t[d].el),o())}),e("#"+p).clear(function(n){d&&t[d]&&t[d]instanceof u&&!0===t[d].dropDown&&(t[d].val(""),e.event.trigger("afterAction",null,t[d].el)),o()}),e("#"+p).ok(function(n){if(d&&t[d]&&t[d]instanceof u&&!0===t[d].useTime&&!0===t[d].dropDown)return t[d].val(this.val()),e.event.trigger("afterAction",null,t[d].el),o(),!1}),e("#"+p+"_float_bg").bind(f,function(){o()}),s)}function o(){if(d){var t=n.getElementById(p+"_float");if(null!=t&&1==t.nodeType){var a=t.className?t.className:"";(" "+a+" ").indexOf(" c_float-show ")>-1&&(t.className=e.trim((" "+a+" ").replace(/ c_float-show /gi," ")))}t=null,d=null}}if(e&&"undefined"==typeof e.DateField){var i=(Array.prototype.push,Array.prototype.splice,n.createElement("input")),l="oninput"in i;i=null;var s,d,r="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in t,f=r?"touchstart":"mousedown",c=e.os.phone||!0===e.ratioPhone,p="_Wade_DropDownCalendar",u=function(t,a){var o=this;o.el=t&&1==t.nodeType?t:n.getElementById(t),o.el&&o.el.nodeType&&(o.id=e.attr(o.el,"id"))&&(a&&e.isObject(a)&&e.extend(o,a),e.attr(o.el,"x-wade-uicomponent")||e.attr(o.el,"x-wade-uicomponent","datefield"),o._init(),o.constructor.call(o))};u.prototype=e.extend(new e.UIComponent,{val:function(e){var t=this;return void 0==e?t.el.value:void(t.value=t.el.value=e)},refresh:function(){var t=this;t.spanEl||(t.spanEl=e(t.el).parent("span.e_mix:first")[0]);var a=t.spanEl.getBoundingClientRect();t.spanLeft=a.left,t.spanTop=a.top,t.spanHeight=t.spanEl.offsetHeight,t.spanWidth=t.spanEl.offsetWidth;var o=t.spanTop,i=(t.spanLeft,n.body),l=i.offsetHeight-t.spanHeight-o;e.isNumber(i.scrollTop)&&(t.spanTop+=i.scrollTop-2),e.isNumber(i.scrollLeft)&&(t.spanLeft+=i.scrollLeft),t.dir=l>=o?"down":"up";var s="down"==t.dir?l:o,d=0,r=0,f=n.getElementById(p+"_float"),c=f.className?f.className:"";(" "+c+" ").indexOf(" c_float-show ")<0?(f.style.left="-99999px",f.style.top="-99999px",f.style.display="block",d=f.offsetWidth,r=f.offsetHeight,f.style.display=""):(d=f.offsetWidth,r=f.offsetHeight);var u=Math.min(s,r),y=document.documentElement.clientHeight;f.style.left=t.spanLeft+t.spanWidth-d+"px",r<=y&&o<r&&l<r?f.style.top=(y-r)/2+"px":f.style.top=("down"==t.dir?t.spanTop+t.spanHeight:t.spanTop-u)+"px"},getDisabled:function(){var e=this;return e.disabled},setDisabled:function(t){var n=this;"undefined"!=typeof t&&(n.disabled=!!t,n.el.disabled=n.disabled,setTimeout(function(){var t=n.spanEl?n.spanEl:n.el,a=t.className?t.className:"";n.disabled?(" "+a+" ").indexOf(" e_dis ")<0&&(t.className=e.trim(a+" e_dis")):(a=e.trim((" "+a+" ").replace(/ e_dis /gi," ")),t.className=a)},0))},getReadonly:function(){var e=this;return e.readonly},setReadonly:function(t){var n=this;"undefined"!=typeof t&&(n.readonly=!!t,setTimeout(function(){e.attr(n.el,"readonly",n.readonly)},0))},destroy:function(){var e=this;e.spanEl=null,e.icoEl=null,e.el=null},_init:function(){var t=this;if(t.spanEl=e(t.el).parent("span.e_mix:first")[0],t.icoEl=e(t.el).next("span.e_ico-date:first")[0],t.icoEl&&(t.icoEl.style.display=t.dropDown?"":"none"),(c||e.os.pad||t.readonly)&&t.setReadonly(!0),t.disabled&&t.setDisabled(!0),l?e(t.el).bind("input",function(e){this.value=(""+this.value).replace(/[^0-9-\/\s:]+/gi,"")}):e(t.el).keydown(function(e){return!(e.shiftKey||e.altKey||e.ctrlKey)&&(e.keyCode>47&&e.keyCode<58||e.keyCode>95&&e.keyCode<106||8==e.keyCode||46==e.keyCode||189==e.keyCode||191==e.keyCode)}),!0===t.dropDown){var o=function(o){if(!t.disabled&&!0===t.dropDown){o.originalEvent&&(o=o.originalEvent),a(),s&&(e.extend(s,{now:t.now,format:t.format,value:t.value,useTime:t.useTime}),s.reset()),t.refresh();var i=n.getElementById(p+"_float"),l=i.className?i.className:"";(" "+l+" ").indexOf(" c_float-show ")<0&&(i.className=e.trim(l+" c_float-show")),d=t.id}};e(t.el).bind("tap",o),e(t.icoEl).bind("tap",o)}}}),e(function(){e(n.body).bind(f,function(t){if(t&&t.target){var a=t.target;if(a&&a.nodeType&&s){for(var i=0,l=!1;a&&a.nodeType&&a!=n.body&&i<50;){var r=e.attr(a,"id");if(r&&e.isString(r)&&(0==r.indexOf(d)||0==r.indexOf(p))){l=!0;break}a=a.parentNode,i++}l||o()}}}),e(t).bind("onorientationchange"in t?"orientationchange":"resize",function(){o()}),r||e(n.body).bind("mousewheel",function(e){o()})}),t.DateField=e.DateField=u}}(window.Wade,window,document);